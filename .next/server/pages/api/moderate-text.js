"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/moderate-text";
exports.ids = ["pages/api/moderate-text"];
exports.modules = {

/***/ "(api-node)/./lib/contentModerator.ts":
/*!*********************************!*\
  !*** ./lib/contentModerator.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   contentModerator: () => (/* binding */ contentModerator)\n/* harmony export */ });\n// lib/contentModerator.ts\n// AI-powered content moderation service for text, images, and videos\nclass ContentModerator {\n    /**\n   * Moderate text content using AI\n   */ async moderateText(text, options = {\n        checkProfanity: true,\n        checkSpam: true,\n        checkIllegalContent: true,\n        checkPersonalInfo: true\n    }) {\n        try {\n            // Simple pattern-based checks first (fast)\n            const quickCheck = this.quickTextCheck(text);\n            if (!quickCheck.approved && quickCheck.confidence > 0.8) {\n                return quickCheck;\n            }\n            // AI-powered deep analysis for complex cases\n            if (this.OPENAI_API_KEY) {\n                return await this.aiModerateText(text, options);\n            }\n            return quickCheck;\n        } catch (error) {\n            console.error('Text moderation error:', error);\n            return {\n                approved: false,\n                confidence: 0.5,\n                reasons: [\n                    'Moderation service temporarily unavailable'\n                ],\n                category: 'safe',\n                suggestedAction: 'review'\n            };\n        }\n    }\n    /**\n   * Moderate image content\n   */ async moderateImage(imageBuffer, fileName, options = {\n        checkNudity: true,\n        checkViolence: true,\n        checkIllegalItems: true,\n        checkSpam: true,\n        maxFileSizeMB: 10\n    }) {\n        try {\n            // File size check\n            const sizeCheck = this.checkFileSize(imageBuffer, options.maxFileSizeMB);\n            if (!sizeCheck.approved) return sizeCheck;\n            // File type validation\n            const typeCheck = this.validateImageType(fileName);\n            if (!typeCheck.approved) return typeCheck;\n            // AI-powered image analysis\n            if (this.OPENAI_API_KEY && typeof imageBuffer !== 'string') {\n                return await this.aiModerateImage(imageBuffer, options);\n            }\n            // Fallback to basic approval for file uploads\n            return {\n                approved: true,\n                confidence: 0.7,\n                reasons: [\n                    'Basic validation passed'\n                ],\n                category: 'safe',\n                suggestedAction: 'approve'\n            };\n        } catch (error) {\n            console.error('Image moderation error:', error);\n            return {\n                approved: false,\n                confidence: 0.5,\n                reasons: [\n                    'Image analysis failed'\n                ],\n                category: 'safe',\n                suggestedAction: 'review'\n            };\n        }\n    }\n    /**\n   * Moderate video content\n   */ async moderateVideo(videoBuffer, fileName, options = {\n        checkNudity: true,\n        checkViolence: true,\n        checkIllegalItems: true,\n        checkSpam: true,\n        maxFileSizeMB: 50\n    }) {\n        try {\n            // File size check\n            const sizeCheck = this.checkFileSize(videoBuffer, options.maxFileSizeMB);\n            if (!sizeCheck.approved) return sizeCheck;\n            // File type validation\n            const typeCheck = this.validateVideoType(fileName);\n            if (!typeCheck.approved) return typeCheck;\n            // For now, basic approval - can be enhanced with video AI later\n            return {\n                approved: true,\n                confidence: 0.6,\n                reasons: [\n                    'Basic video validation passed'\n                ],\n                category: 'safe',\n                suggestedAction: 'approve'\n            };\n        } catch (error) {\n            console.error('Video moderation error:', error);\n            return {\n                approved: false,\n                confidence: 0.5,\n                reasons: [\n                    'Video analysis failed'\n                ],\n                category: 'safe',\n                suggestedAction: 'review'\n            };\n        }\n    }\n    /**\n   * Quick pattern-based text checking\n   */ quickTextCheck(text) {\n        const lowerText = text.toLowerCase();\n        const issues = [];\n        // Check for obvious profanity/inappropriate content\n        const profanityPatterns = [\n            /f[*u]ck/gi,\n            /sh[*i]t/gi,\n            /b[*i]tch/gi,\n            /d[*a]mn/gi,\n            /ass(hole)?/gi,\n            /crap/gi,\n            /hell/gi\n        ];\n        const inappropriatePatterns = [\n            /sex/gi,\n            /porn/gi,\n            /nude/gi,\n            /naked/gi,\n            /drug/gi,\n            /weed/gi,\n            /cocaine/gi,\n            /meth/gi,\n            /gun/gi,\n            /weapon/gi,\n            /kill/gi,\n            /murder/gi\n        ];\n        // Check for personal information\n        const personalInfoPatterns = [\n            /\\d{3}-\\d{2}-\\d{4}/g,\n            /\\d{4}[- ]?\\d{4}[- ]?\\d{4}[- ]?\\d{4}/g,\n            /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/g // Email (in inappropriate context)\n        ];\n        // Check for spam patterns\n        const spamPatterns = [\n            /click here/gi,\n            /free money/gi,\n            /get rich quick/gi,\n            /act now/gi,\n            /limited time/gi,\n            /guarantee/gi\n        ];\n        let severity = 0;\n        // Profanity check\n        profanityPatterns.forEach((pattern)=>{\n            if (pattern.test(lowerText)) {\n                issues.push('Contains inappropriate language');\n                severity += 0.3;\n            }\n        });\n        // Inappropriate content check\n        inappropriatePatterns.forEach((pattern)=>{\n            if (pattern.test(lowerText)) {\n                issues.push('Contains potentially inappropriate content');\n                severity += 0.4;\n            }\n        });\n        // Personal info check\n        personalInfoPatterns.forEach((pattern)=>{\n            if (pattern.test(text)) {\n                issues.push('Contains personal information');\n                severity += 0.6;\n            }\n        });\n        // Spam check\n        spamPatterns.forEach((pattern)=>{\n            if (pattern.test(lowerText)) {\n                issues.push('Contains spam-like content');\n                severity += 0.2;\n            }\n        });\n        const approved = severity < 0.5;\n        const confidence = Math.min(0.9, Math.max(0.1, 1 - severity));\n        return {\n            approved,\n            confidence,\n            reasons: issues.length > 0 ? issues : [\n                'Content appears appropriate'\n            ],\n            category: severity > 0.7 ? 'illegal' : severity > 0.5 ? 'inappropriate' : severity > 0.3 ? 'spam' : 'safe',\n            suggestedAction: severity > 0.7 ? 'reject' : severity > 0.5 ? 'flag' : severity > 0.3 ? 'review' : 'approve'\n        };\n    }\n    /**\n   * AI-powered text moderation using OpenAI\n   */ async aiModerateText(text, options) {\n        try {\n            const response = await fetch('https://api.openai.com/v1/moderations', {\n                method: 'POST',\n                headers: {\n                    'Authorization': `Bearer ${this.OPENAI_API_KEY}`,\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    input: text,\n                    model: 'text-moderation-latest'\n                })\n            });\n            const data = await response.json();\n            const result = data.results[0];\n            const issues = [];\n            let category = 'safe';\n            if (result.flagged) {\n                if (result.categories.sexual) {\n                    issues.push('Sexual content detected');\n                    category = 'inappropriate';\n                }\n                if (result.categories.hate) {\n                    issues.push('Hate speech detected');\n                    category = 'inappropriate';\n                }\n                if (result.categories.violence) {\n                    issues.push('Violent content detected');\n                    category = 'inappropriate';\n                }\n                if (result.categories['self-harm']) {\n                    issues.push('Self-harm content detected');\n                    category = 'harmful';\n                }\n                if (result.categories.illegal) {\n                    issues.push('Illegal content detected');\n                    category = 'illegal';\n                }\n            }\n            return {\n                approved: !result.flagged,\n                confidence: 0.95,\n                reasons: issues.length > 0 ? issues : [\n                    'Content approved by AI moderation'\n                ],\n                category,\n                suggestedAction: result.flagged ? 'reject' : 'approve'\n            };\n        } catch (error) {\n            console.error('AI text moderation error:', error);\n            return this.quickTextCheck(text);\n        }\n    }\n    /**\n   * AI-powered image moderation\n   */ async aiModerateImage(imageBuffer, options) {\n        try {\n            // Convert buffer to base64\n            const base64Image = imageBuffer.toString('base64');\n            const response = await fetch('https://api.openai.com/v1/chat/completions', {\n                method: 'POST',\n                headers: {\n                    'Authorization': `Bearer ${this.OPENAI_API_KEY}`,\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    model: 'gpt-4-vision-preview',\n                    messages: [\n                        {\n                            role: 'system',\n                            content: 'You are a content moderator. Analyze this image and determine if it contains inappropriate content like nudity, violence, illegal items, or spam. Respond with a JSON object containing: approved (boolean), reasons (array of strings), category (safe/inappropriate/illegal/spam).'\n                        },\n                        {\n                            role: 'user',\n                            content: [\n                                {\n                                    type: 'text',\n                                    text: 'Please moderate this image for community safety.'\n                                },\n                                {\n                                    type: 'image_url',\n                                    image_url: {\n                                        url: `data:image/jpeg;base64,${base64Image}`\n                                    }\n                                }\n                            ]\n                        }\n                    ],\n                    max_tokens: 300\n                })\n            });\n            const data = await response.json();\n            const aiResponse = JSON.parse(data.choices[0].message.content);\n            return {\n                approved: aiResponse.approved,\n                confidence: 0.9,\n                reasons: aiResponse.reasons || [\n                    'AI analysis completed'\n                ],\n                category: aiResponse.category || 'safe',\n                suggestedAction: aiResponse.approved ? 'approve' : 'reject'\n            };\n        } catch (error) {\n            console.error('AI image moderation error:', error);\n            return {\n                approved: true,\n                confidence: 0.5,\n                reasons: [\n                    'AI moderation unavailable, manual review recommended'\n                ],\n                category: 'safe',\n                suggestedAction: 'review'\n            };\n        }\n    }\n    /**\n   * Validate file size\n   */ checkFileSize(buffer, maxSizeMB) {\n        const size = typeof buffer === 'string' ? buffer.length : buffer.length;\n        const maxBytes = maxSizeMB * 1024 * 1024;\n        if (size > maxBytes) {\n            return {\n                approved: false,\n                confidence: 1.0,\n                reasons: [\n                    `File size (${(size / 1024 / 1024).toFixed(1)}MB) exceeds limit (${maxSizeMB}MB)`\n                ],\n                category: 'spam',\n                suggestedAction: 'reject'\n            };\n        }\n        return {\n            approved: true,\n            confidence: 1.0,\n            reasons: [\n                'File size acceptable'\n            ],\n            category: 'safe',\n            suggestedAction: 'approve'\n        };\n    }\n    /**\n   * Validate image file type\n   */ validateImageType(fileName) {\n        const allowedTypes = [\n            '.jpg',\n            '.jpeg',\n            '.png',\n            '.gif',\n            '.webp'\n        ];\n        const extension = fileName.toLowerCase().substring(fileName.lastIndexOf('.'));\n        if (!allowedTypes.includes(extension)) {\n            return {\n                approved: false,\n                confidence: 1.0,\n                reasons: [\n                    `File type ${extension} not allowed. Allowed: ${allowedTypes.join(', ')}`\n                ],\n                category: 'inappropriate',\n                suggestedAction: 'reject'\n            };\n        }\n        return {\n            approved: true,\n            confidence: 1.0,\n            reasons: [\n                'Image file type valid'\n            ],\n            category: 'safe',\n            suggestedAction: 'approve'\n        };\n    }\n    /**\n   * Validate video file type\n   */ validateVideoType(fileName) {\n        const allowedTypes = [\n            '.mp4',\n            '.webm',\n            '.mov',\n            '.avi'\n        ];\n        const extension = fileName.toLowerCase().substring(fileName.lastIndexOf('.'));\n        if (!allowedTypes.includes(extension)) {\n            return {\n                approved: false,\n                confidence: 1.0,\n                reasons: [\n                    `Video type ${extension} not allowed. Allowed: ${allowedTypes.join(', ')}`\n                ],\n                category: 'inappropriate',\n                suggestedAction: 'reject'\n            };\n        }\n        return {\n            approved: true,\n            confidence: 1.0,\n            reasons: [\n                'Video file type valid'\n            ],\n            category: 'safe',\n            suggestedAction: 'approve'\n        };\n    }\n    constructor(){\n        this.OPENAI_API_KEY = process.env.OPENAI_API_KEY;\n        this.CONTENT_POLICY = {\n            // Define what's not allowed\n            prohibited: [\n                'explicit sexual content',\n                'violence or threats',\n                'illegal drugs or weapons',\n                'hate speech',\n                'personal information (SSN, credit cards)',\n                'spam or promotional content',\n                'scams or fraudulent offers',\n                'inappropriate images of minors'\n            ],\n            // Define what's encouraged\n            encouraged: [\n                'community assistance',\n                'respectful communication',\n                'legitimate help requests',\n                'appropriate documentation'\n            ]\n        };\n    }\n}\nconst contentModerator = new ContentModerator();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ckMsT0FBTztnQkFDTDlFLFVBQVU7Z0JBQ1ZDLFlBQVk7Z0JBQ1pLLFNBQVM7b0JBQUMsQ0FBQyxXQUFXLEVBQUV3RSxVQUFVLHVCQUF1QixFQUFFRCxhQUFhSyxJQUFJLENBQUMsT0FBTztpQkFBQztnQkFDckYzRSxVQUFVO2dCQUNWQyxpQkFBaUI7WUFDbkI7UUFDRjtRQUVBLE9BQU87WUFDTFIsVUFBVTtZQUNWQyxZQUFZO1lBQ1pLLFNBQVM7Z0JBQUM7YUFBd0I7WUFDbENDLFVBQVU7WUFDVkMsaUJBQWlCO1FBQ25CO0lBQ0Y7O2FBMWFpQk4saUJBQWlCaUYsUUFBUUMsR0FBRyxDQUFDbEYsY0FBYzthQUMzQ21GLGlCQUFpQjtZQUNoQyw0QkFBNEI7WUFDNUJDLFlBQVk7Z0JBQ1Y7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7Z0JBQ0E7YUFDRDtZQUNELDJCQUEyQjtZQUMzQkMsWUFBWTtnQkFDVjtnQkFDQTtnQkFDQTtnQkFDQTthQUNEO1FBQ0g7O0FBdVpGO0FBRU8sTUFBTUMsbUJBQW1CLElBQUlsRyxtQkFBbUIiLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvbGliL2NvbnRlbnRNb2RlcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL2NvbnRlbnRNb2RlcmF0b3IudHNcbi8vIEFJLXBvd2VyZWQgY29udGVudCBtb2RlcmF0aW9uIHNlcnZpY2UgZm9yIHRleHQsIGltYWdlcywgYW5kIHZpZGVvc1xuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVyYXRpb25SZXN1bHQge1xuICBhcHByb3ZlZDogYm9vbGVhbjtcbiAgY29uZmlkZW5jZTogbnVtYmVyO1xuICByZWFzb25zOiBzdHJpbmdbXTtcbiAgY2F0ZWdvcnk6ICdzYWZlJyB8ICdpbmFwcHJvcHJpYXRlJyB8ICdpbGxlZ2FsJyB8ICdzcGFtJyB8ICdoYXJtZnVsJztcbiAgc3VnZ2VzdGVkQWN0aW9uOiAnYXBwcm92ZScgfCAncmV2aWV3JyB8ICdyZWplY3QnIHwgJ2ZsYWcnO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRNb2RlcmF0aW9uT3B0aW9ucyB7XG4gIGNoZWNrUHJvZmFuaXR5OiBib29sZWFuO1xuICBjaGVja1NwYW06IGJvb2xlYW47XG4gIGNoZWNrSWxsZWdhbENvbnRlbnQ6IGJvb2xlYW47XG4gIGNoZWNrUGVyc29uYWxJbmZvOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lZGlhTW9kZXJhdGlvbk9wdGlvbnMge1xuICBjaGVja051ZGl0eTogYm9vbGVhbjtcbiAgY2hlY2tWaW9sZW5jZTogYm9vbGVhbjtcbiAgY2hlY2tJbGxlZ2FsSXRlbXM6IGJvb2xlYW47XG4gIGNoZWNrU3BhbTogYm9vbGVhbjtcbiAgbWF4RmlsZVNpemVNQjogbnVtYmVyO1xufVxuXG5jbGFzcyBDb250ZW50TW9kZXJhdG9yIHtcbiAgcHJpdmF0ZSByZWFkb25seSBPUEVOQUlfQVBJX0tFWSA9IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZO1xuICBwcml2YXRlIHJlYWRvbmx5IENPTlRFTlRfUE9MSUNZID0ge1xuICAgIC8vIERlZmluZSB3aGF0J3Mgbm90IGFsbG93ZWRcbiAgICBwcm9oaWJpdGVkOiBbXG4gICAgICAnZXhwbGljaXQgc2V4dWFsIGNvbnRlbnQnLFxuICAgICAgJ3Zpb2xlbmNlIG9yIHRocmVhdHMnLFxuICAgICAgJ2lsbGVnYWwgZHJ1Z3Mgb3Igd2VhcG9ucycsXG4gICAgICAnaGF0ZSBzcGVlY2gnLFxuICAgICAgJ3BlcnNvbmFsIGluZm9ybWF0aW9uIChTU04sIGNyZWRpdCBjYXJkcyknLFxuICAgICAgJ3NwYW0gb3IgcHJvbW90aW9uYWwgY29udGVudCcsXG4gICAgICAnc2NhbXMgb3IgZnJhdWR1bGVudCBvZmZlcnMnLFxuICAgICAgJ2luYXBwcm9wcmlhdGUgaW1hZ2VzIG9mIG1pbm9ycydcbiAgICBdLFxuICAgIC8vIERlZmluZSB3aGF0J3MgZW5jb3VyYWdlZFxuICAgIGVuY291cmFnZWQ6IFtcbiAgICAgICdjb21tdW5pdHkgYXNzaXN0YW5jZScsXG4gICAgICAncmVzcGVjdGZ1bCBjb21tdW5pY2F0aW9uJyxcbiAgICAgICdsZWdpdGltYXRlIGhlbHAgcmVxdWVzdHMnLFxuICAgICAgJ2FwcHJvcHJpYXRlIGRvY3VtZW50YXRpb24nXG4gICAgXVxuICB9O1xuXG4gIC8qKlxuICAgKiBNb2RlcmF0ZSB0ZXh0IGNvbnRlbnQgdXNpbmcgQUlcbiAgICovXG4gIGFzeW5jIG1vZGVyYXRlVGV4dChcbiAgICB0ZXh0OiBzdHJpbmcsIFxuICAgIG9wdGlvbnM6IFRleHRNb2RlcmF0aW9uT3B0aW9ucyA9IHtcbiAgICAgIGNoZWNrUHJvZmFuaXR5OiB0cnVlLFxuICAgICAgY2hlY2tTcGFtOiB0cnVlLFxuICAgICAgY2hlY2tJbGxlZ2FsQ29udGVudDogdHJ1ZSxcbiAgICAgIGNoZWNrUGVyc29uYWxJbmZvOiB0cnVlXG4gICAgfVxuICApOiBQcm9taXNlPE1vZGVyYXRpb25SZXN1bHQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU2ltcGxlIHBhdHRlcm4tYmFzZWQgY2hlY2tzIGZpcnN0IChmYXN0KVxuICAgICAgY29uc3QgcXVpY2tDaGVjayA9IHRoaXMucXVpY2tUZXh0Q2hlY2sodGV4dCk7XG4gICAgICBpZiAoIXF1aWNrQ2hlY2suYXBwcm92ZWQgJiYgcXVpY2tDaGVjay5jb25maWRlbmNlID4gMC44KSB7XG4gICAgICAgIHJldHVybiBxdWlja0NoZWNrO1xuICAgICAgfVxuXG4gICAgICAvLyBBSS1wb3dlcmVkIGRlZXAgYW5hbHlzaXMgZm9yIGNvbXBsZXggY2FzZXNcbiAgICAgIGlmICh0aGlzLk9QRU5BSV9BUElfS0VZKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmFpTW9kZXJhdGVUZXh0KHRleHQsIG9wdGlvbnMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcXVpY2tDaGVjaztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVGV4dCBtb2RlcmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcHJvdmVkOiBmYWxzZSxcbiAgICAgICAgY29uZmlkZW5jZTogMC41LFxuICAgICAgICByZWFzb25zOiBbJ01vZGVyYXRpb24gc2VydmljZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZSddLFxuICAgICAgICBjYXRlZ29yeTogJ3NhZmUnLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb246ICdyZXZpZXcnXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNb2RlcmF0ZSBpbWFnZSBjb250ZW50XG4gICAqL1xuICBhc3luYyBtb2RlcmF0ZUltYWdlKFxuICAgIGltYWdlQnVmZmVyOiBCdWZmZXIgfCBzdHJpbmcsIFxuICAgIGZpbGVOYW1lOiBzdHJpbmcsXG4gICAgb3B0aW9uczogTWVkaWFNb2RlcmF0aW9uT3B0aW9ucyA9IHtcbiAgICAgIGNoZWNrTnVkaXR5OiB0cnVlLFxuICAgICAgY2hlY2tWaW9sZW5jZTogdHJ1ZSxcbiAgICAgIGNoZWNrSWxsZWdhbEl0ZW1zOiB0cnVlLFxuICAgICAgY2hlY2tTcGFtOiB0cnVlLFxuICAgICAgbWF4RmlsZVNpemVNQjogMTBcbiAgICB9XG4gICk6IFByb21pc2U8TW9kZXJhdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBGaWxlIHNpemUgY2hlY2tcbiAgICAgIGNvbnN0IHNpemVDaGVjayA9IHRoaXMuY2hlY2tGaWxlU2l6ZShpbWFnZUJ1ZmZlciwgb3B0aW9ucy5tYXhGaWxlU2l6ZU1CKTtcbiAgICAgIGlmICghc2l6ZUNoZWNrLmFwcHJvdmVkKSByZXR1cm4gc2l6ZUNoZWNrO1xuXG4gICAgICAvLyBGaWxlIHR5cGUgdmFsaWRhdGlvblxuICAgICAgY29uc3QgdHlwZUNoZWNrID0gdGhpcy52YWxpZGF0ZUltYWdlVHlwZShmaWxlTmFtZSk7XG4gICAgICBpZiAoIXR5cGVDaGVjay5hcHByb3ZlZCkgcmV0dXJuIHR5cGVDaGVjaztcblxuICAgICAgLy8gQUktcG93ZXJlZCBpbWFnZSBhbmFseXNpc1xuICAgICAgaWYgKHRoaXMuT1BFTkFJX0FQSV9LRVkgJiYgdHlwZW9mIGltYWdlQnVmZmVyICE9PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5haU1vZGVyYXRlSW1hZ2UoaW1hZ2VCdWZmZXIsIG9wdGlvbnMpO1xuICAgICAgfVxuXG4gICAgICAvLyBGYWxsYmFjayB0byBiYXNpYyBhcHByb3ZhbCBmb3IgZmlsZSB1cGxvYWRzXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHByb3ZlZDogdHJ1ZSxcbiAgICAgICAgY29uZmlkZW5jZTogMC43LFxuICAgICAgICByZWFzb25zOiBbJ0Jhc2ljIHZhbGlkYXRpb24gcGFzc2VkJ10sXG4gICAgICAgIGNhdGVnb3J5OiAnc2FmZScsXG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbjogJ2FwcHJvdmUnXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdJbWFnZSBtb2RlcmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcHJvdmVkOiBmYWxzZSxcbiAgICAgICAgY29uZmlkZW5jZTogMC41LFxuICAgICAgICByZWFzb25zOiBbJ0ltYWdlIGFuYWx5c2lzIGZhaWxlZCddLFxuICAgICAgICBjYXRlZ29yeTogJ3NhZmUnLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb246ICdyZXZpZXcnXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNb2RlcmF0ZSB2aWRlbyBjb250ZW50XG4gICAqL1xuICBhc3luYyBtb2RlcmF0ZVZpZGVvKFxuICAgIHZpZGVvQnVmZmVyOiBCdWZmZXIsIFxuICAgIGZpbGVOYW1lOiBzdHJpbmcsXG4gICAgb3B0aW9uczogTWVkaWFNb2RlcmF0aW9uT3B0aW9ucyA9IHtcbiAgICAgIGNoZWNrTnVkaXR5OiB0cnVlLFxuICAgICAgY2hlY2tWaW9sZW5jZTogdHJ1ZSxcbiAgICAgIGNoZWNrSWxsZWdhbEl0ZW1zOiB0cnVlLFxuICAgICAgY2hlY2tTcGFtOiB0cnVlLFxuICAgICAgbWF4RmlsZVNpemVNQjogNTBcbiAgICB9XG4gICk6IFByb21pc2U8TW9kZXJhdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBGaWxlIHNpemUgY2hlY2tcbiAgICAgIGNvbnN0IHNpemVDaGVjayA9IHRoaXMuY2hlY2tGaWxlU2l6ZSh2aWRlb0J1ZmZlciwgb3B0aW9ucy5tYXhGaWxlU2l6ZU1CKTtcbiAgICAgIGlmICghc2l6ZUNoZWNrLmFwcHJvdmVkKSByZXR1cm4gc2l6ZUNoZWNrO1xuXG4gICAgICAvLyBGaWxlIHR5cGUgdmFsaWRhdGlvblxuICAgICAgY29uc3QgdHlwZUNoZWNrID0gdGhpcy52YWxpZGF0ZVZpZGVvVHlwZShmaWxlTmFtZSk7XG4gICAgICBpZiAoIXR5cGVDaGVjay5hcHByb3ZlZCkgcmV0dXJuIHR5cGVDaGVjaztcblxuICAgICAgLy8gRm9yIG5vdywgYmFzaWMgYXBwcm92YWwgLSBjYW4gYmUgZW5oYW5jZWQgd2l0aCB2aWRlbyBBSSBsYXRlclxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwcm92ZWQ6IHRydWUsXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuNixcbiAgICAgICAgcmVhc29uczogWydCYXNpYyB2aWRlbyB2YWxpZGF0aW9uIHBhc3NlZCddLFxuICAgICAgICBjYXRlZ29yeTogJ3NhZmUnLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb246ICdhcHByb3ZlJ1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVmlkZW8gbW9kZXJhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHByb3ZlZDogZmFsc2UsXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuNSxcbiAgICAgICAgcmVhc29uczogWydWaWRlbyBhbmFseXNpcyBmYWlsZWQnXSxcbiAgICAgICAgY2F0ZWdvcnk6ICdzYWZlJyxcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uOiAncmV2aWV3J1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUXVpY2sgcGF0dGVybi1iYXNlZCB0ZXh0IGNoZWNraW5nXG4gICAqL1xuICBwcml2YXRlIHF1aWNrVGV4dENoZWNrKHRleHQ6IHN0cmluZyk6IE1vZGVyYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IGxvd2VyVGV4dCA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBpc3N1ZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBDaGVjayBmb3Igb2J2aW91cyBwcm9mYW5pdHkvaW5hcHByb3ByaWF0ZSBjb250ZW50XG4gICAgY29uc3QgcHJvZmFuaXR5UGF0dGVybnMgPSBbXG4gICAgICAvZlsqdV1jay9naSwgL3NoWyppXXQvZ2ksIC9iWyppXXRjaC9naSwgL2RbKmFdbW4vZ2ksXG4gICAgICAvYXNzKGhvbGUpPy9naSwgL2NyYXAvZ2ksIC9oZWxsL2dpXG4gICAgXTtcbiAgICBcbiAgICBjb25zdCBpbmFwcHJvcHJpYXRlUGF0dGVybnMgPSBbXG4gICAgICAvc2V4L2dpLCAvcG9ybi9naSwgL251ZGUvZ2ksIC9uYWtlZC9naSxcbiAgICAgIC9kcnVnL2dpLCAvd2VlZC9naSwgL2NvY2FpbmUvZ2ksIC9tZXRoL2dpLFxuICAgICAgL2d1bi9naSwgL3dlYXBvbi9naSwgL2tpbGwvZ2ksIC9tdXJkZXIvZ2lcbiAgICBdO1xuXG4gICAgLy8gQ2hlY2sgZm9yIHBlcnNvbmFsIGluZm9ybWF0aW9uXG4gICAgY29uc3QgcGVyc29uYWxJbmZvUGF0dGVybnMgPSBbXG4gICAgICAvXFxkezN9LVxcZHsyfS1cXGR7NH0vZywgLy8gU1NOXG4gICAgICAvXFxkezR9Wy0gXT9cXGR7NH1bLSBdP1xcZHs0fVstIF0/XFxkezR9L2csIC8vIENyZWRpdCBjYXJkXG4gICAgICAvW2EtekEtWjAtOS5fJSstXStAW2EtekEtWjAtOS4tXStcXC5bYS16QS1aXXsyLH0vZyAvLyBFbWFpbCAoaW4gaW5hcHByb3ByaWF0ZSBjb250ZXh0KVxuICAgIF07XG5cbiAgICAvLyBDaGVjayBmb3Igc3BhbSBwYXR0ZXJuc1xuICAgIGNvbnN0IHNwYW1QYXR0ZXJucyA9IFtcbiAgICAgIC9jbGljayBoZXJlL2dpLCAvZnJlZSBtb25leS9naSwgL2dldCByaWNoIHF1aWNrL2dpLFxuICAgICAgL2FjdCBub3cvZ2ksIC9saW1pdGVkIHRpbWUvZ2ksIC9ndWFyYW50ZWUvZ2lcbiAgICBdO1xuXG4gICAgbGV0IHNldmVyaXR5ID0gMDtcblxuICAgIC8vIFByb2Zhbml0eSBjaGVja1xuICAgIHByb2Zhbml0eVBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgICBpZiAocGF0dGVybi50ZXN0KGxvd2VyVGV4dCkpIHtcbiAgICAgICAgaXNzdWVzLnB1c2goJ0NvbnRhaW5zIGluYXBwcm9wcmlhdGUgbGFuZ3VhZ2UnKTtcbiAgICAgICAgc2V2ZXJpdHkgKz0gMC4zO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSW5hcHByb3ByaWF0ZSBjb250ZW50IGNoZWNrXG4gICAgaW5hcHByb3ByaWF0ZVBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgICBpZiAocGF0dGVybi50ZXN0KGxvd2VyVGV4dCkpIHtcbiAgICAgICAgaXNzdWVzLnB1c2goJ0NvbnRhaW5zIHBvdGVudGlhbGx5IGluYXBwcm9wcmlhdGUgY29udGVudCcpO1xuICAgICAgICBzZXZlcml0eSArPSAwLjQ7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBQZXJzb25hbCBpbmZvIGNoZWNrXG4gICAgcGVyc29uYWxJbmZvUGF0dGVybnMuZm9yRWFjaChwYXR0ZXJuID0+IHtcbiAgICAgIGlmIChwYXR0ZXJuLnRlc3QodGV4dCkpIHtcbiAgICAgICAgaXNzdWVzLnB1c2goJ0NvbnRhaW5zIHBlcnNvbmFsIGluZm9ybWF0aW9uJyk7XG4gICAgICAgIHNldmVyaXR5ICs9IDAuNjtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNwYW0gY2hlY2tcbiAgICBzcGFtUGF0dGVybnMuZm9yRWFjaChwYXR0ZXJuID0+IHtcbiAgICAgIGlmIChwYXR0ZXJuLnRlc3QobG93ZXJUZXh0KSkge1xuICAgICAgICBpc3N1ZXMucHVzaCgnQ29udGFpbnMgc3BhbS1saWtlIGNvbnRlbnQnKTtcbiAgICAgICAgc2V2ZXJpdHkgKz0gMC4yO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgYXBwcm92ZWQgPSBzZXZlcml0eSA8IDAuNTtcbiAgICBjb25zdCBjb25maWRlbmNlID0gTWF0aC5taW4oMC45LCBNYXRoLm1heCgwLjEsIDEgLSBzZXZlcml0eSkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFwcHJvdmVkLFxuICAgICAgY29uZmlkZW5jZSxcbiAgICAgIHJlYXNvbnM6IGlzc3Vlcy5sZW5ndGggPiAwID8gaXNzdWVzIDogWydDb250ZW50IGFwcGVhcnMgYXBwcm9wcmlhdGUnXSxcbiAgICAgIGNhdGVnb3J5OiBzZXZlcml0eSA+IDAuNyA/ICdpbGxlZ2FsJyA6IHNldmVyaXR5ID4gMC41ID8gJ2luYXBwcm9wcmlhdGUnIDogc2V2ZXJpdHkgPiAwLjMgPyAnc3BhbScgOiAnc2FmZScsXG4gICAgICBzdWdnZXN0ZWRBY3Rpb246IHNldmVyaXR5ID4gMC43ID8gJ3JlamVjdCcgOiBzZXZlcml0eSA+IDAuNSA/ICdmbGFnJyA6IHNldmVyaXR5ID4gMC4zID8gJ3JldmlldycgOiAnYXBwcm92ZSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFJLXBvd2VyZWQgdGV4dCBtb2RlcmF0aW9uIHVzaW5nIE9wZW5BSVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhaU1vZGVyYXRlVGV4dCh0ZXh0OiBzdHJpbmcsIG9wdGlvbnM6IFRleHRNb2RlcmF0aW9uT3B0aW9ucyk6IFByb21pc2U8TW9kZXJhdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL21vZGVyYXRpb25zJywge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuT1BFTkFJX0FQSV9LRVl9YCxcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaW5wdXQ6IHRleHQsXG4gICAgICAgICAgbW9kZWw6ICd0ZXh0LW1vZGVyYXRpb24tbGF0ZXN0J1xuICAgICAgICB9KVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBkYXRhLnJlc3VsdHNbMF07XG5cbiAgICAgIGNvbnN0IGlzc3Vlczogc3RyaW5nW10gPSBbXTtcbiAgICAgIGxldCBjYXRlZ29yeTogTW9kZXJhdGlvblJlc3VsdFsnY2F0ZWdvcnknXSA9ICdzYWZlJztcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5mbGFnZ2VkKSB7XG4gICAgICAgIGlmIChyZXN1bHQuY2F0ZWdvcmllcy5zZXh1YWwpIHtcbiAgICAgICAgICBpc3N1ZXMucHVzaCgnU2V4dWFsIGNvbnRlbnQgZGV0ZWN0ZWQnKTtcbiAgICAgICAgICBjYXRlZ29yeSA9ICdpbmFwcHJvcHJpYXRlJztcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmNhdGVnb3JpZXMuaGF0ZSkge1xuICAgICAgICAgIGlzc3Vlcy5wdXNoKCdIYXRlIHNwZWVjaCBkZXRlY3RlZCcpO1xuICAgICAgICAgIGNhdGVnb3J5ID0gJ2luYXBwcm9wcmlhdGUnO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuY2F0ZWdvcmllcy52aW9sZW5jZSkge1xuICAgICAgICAgIGlzc3Vlcy5wdXNoKCdWaW9sZW50IGNvbnRlbnQgZGV0ZWN0ZWQnKTtcbiAgICAgICAgICBjYXRlZ29yeSA9ICdpbmFwcHJvcHJpYXRlJztcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmNhdGVnb3JpZXNbJ3NlbGYtaGFybSddKSB7XG4gICAgICAgICAgaXNzdWVzLnB1c2goJ1NlbGYtaGFybSBjb250ZW50IGRldGVjdGVkJyk7XG4gICAgICAgICAgY2F0ZWdvcnkgPSAnaGFybWZ1bCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5jYXRlZ29yaWVzLmlsbGVnYWwpIHtcbiAgICAgICAgICBpc3N1ZXMucHVzaCgnSWxsZWdhbCBjb250ZW50IGRldGVjdGVkJyk7XG4gICAgICAgICAgY2F0ZWdvcnkgPSAnaWxsZWdhbCc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwcm92ZWQ6ICFyZXN1bHQuZmxhZ2dlZCxcbiAgICAgICAgY29uZmlkZW5jZTogMC45NSxcbiAgICAgICAgcmVhc29uczogaXNzdWVzLmxlbmd0aCA+IDAgPyBpc3N1ZXMgOiBbJ0NvbnRlbnQgYXBwcm92ZWQgYnkgQUkgbW9kZXJhdGlvbiddLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uOiByZXN1bHQuZmxhZ2dlZCA/ICdyZWplY3QnIDogJ2FwcHJvdmUnXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBSSB0ZXh0IG1vZGVyYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHRoaXMucXVpY2tUZXh0Q2hlY2sodGV4dCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFJLXBvd2VyZWQgaW1hZ2UgbW9kZXJhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhaU1vZGVyYXRlSW1hZ2UoaW1hZ2VCdWZmZXI6IEJ1ZmZlciwgb3B0aW9uczogTWVkaWFNb2RlcmF0aW9uT3B0aW9ucyk6IFByb21pc2U8TW9kZXJhdGlvblJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDb252ZXJ0IGJ1ZmZlciB0byBiYXNlNjRcbiAgICAgIGNvbnN0IGJhc2U2NEltYWdlID0gaW1hZ2VCdWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2NoYXQvY29tcGxldGlvbnMnLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5PUEVOQUlfQVBJX0tFWX1gLFxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBtb2RlbDogJ2dwdC00LXZpc2lvbi1wcmV2aWV3JyxcbiAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICAgICAgY29udGVudDogJ1lvdSBhcmUgYSBjb250ZW50IG1vZGVyYXRvci4gQW5hbHl6ZSB0aGlzIGltYWdlIGFuZCBkZXRlcm1pbmUgaWYgaXQgY29udGFpbnMgaW5hcHByb3ByaWF0ZSBjb250ZW50IGxpa2UgbnVkaXR5LCB2aW9sZW5jZSwgaWxsZWdhbCBpdGVtcywgb3Igc3BhbS4gUmVzcG9uZCB3aXRoIGEgSlNPTiBvYmplY3QgY29udGFpbmluZzogYXBwcm92ZWQgKGJvb2xlYW4pLCByZWFzb25zIChhcnJheSBvZiBzdHJpbmdzKSwgY2F0ZWdvcnkgKHNhZmUvaW5hcHByb3ByaWF0ZS9pbGxlZ2FsL3NwYW0pLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICAgIHRleHQ6ICdQbGVhc2UgbW9kZXJhdGUgdGhpcyBpbWFnZSBmb3IgY29tbXVuaXR5IHNhZmV0eS4nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2VfdXJsJyxcbiAgICAgICAgICAgICAgICAgIGltYWdlX3VybDoge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCR7YmFzZTY0SW1hZ2V9YFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWF4X3Rva2VuczogMzAwXG4gICAgICAgIH0pXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnN0IGFpUmVzcG9uc2UgPSBKU09OLnBhcnNlKGRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHByb3ZlZDogYWlSZXNwb25zZS5hcHByb3ZlZCxcbiAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICByZWFzb25zOiBhaVJlc3BvbnNlLnJlYXNvbnMgfHwgWydBSSBhbmFseXNpcyBjb21wbGV0ZWQnXSxcbiAgICAgICAgY2F0ZWdvcnk6IGFpUmVzcG9uc2UuY2F0ZWdvcnkgfHwgJ3NhZmUnLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb246IGFpUmVzcG9uc2UuYXBwcm92ZWQgPyAnYXBwcm92ZScgOiAncmVqZWN0J1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQUkgaW1hZ2UgbW9kZXJhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHByb3ZlZDogdHJ1ZSxcbiAgICAgICAgY29uZmlkZW5jZTogMC41LFxuICAgICAgICByZWFzb25zOiBbJ0FJIG1vZGVyYXRpb24gdW5hdmFpbGFibGUsIG1hbnVhbCByZXZpZXcgcmVjb21tZW5kZWQnXSxcbiAgICAgICAgY2F0ZWdvcnk6ICdzYWZlJyxcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uOiAncmV2aWV3J1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgZmlsZSBzaXplXG4gICAqL1xuICBwcml2YXRlIGNoZWNrRmlsZVNpemUoYnVmZmVyOiBCdWZmZXIgfCBzdHJpbmcsIG1heFNpemVNQjogbnVtYmVyKTogTW9kZXJhdGlvblJlc3VsdCB7XG4gICAgY29uc3Qgc2l6ZSA9IHR5cGVvZiBidWZmZXIgPT09ICdzdHJpbmcnID8gYnVmZmVyLmxlbmd0aCA6IGJ1ZmZlci5sZW5ndGg7XG4gICAgY29uc3QgbWF4Qnl0ZXMgPSBtYXhTaXplTUIgKiAxMDI0ICogMTAyNDtcbiAgICBcbiAgICBpZiAoc2l6ZSA+IG1heEJ5dGVzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHByb3ZlZDogZmFsc2UsXG4gICAgICAgIGNvbmZpZGVuY2U6IDEuMCxcbiAgICAgICAgcmVhc29uczogW2BGaWxlIHNpemUgKCR7KHNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKX1NQikgZXhjZWVkcyBsaW1pdCAoJHttYXhTaXplTUJ9TUIpYF0sXG4gICAgICAgIGNhdGVnb3J5OiAnc3BhbScsXG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbjogJ3JlamVjdCdcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBhcHByb3ZlZDogdHJ1ZSxcbiAgICAgIGNvbmZpZGVuY2U6IDEuMCxcbiAgICAgIHJlYXNvbnM6IFsnRmlsZSBzaXplIGFjY2VwdGFibGUnXSxcbiAgICAgIGNhdGVnb3J5OiAnc2FmZScsXG4gICAgICBzdWdnZXN0ZWRBY3Rpb246ICdhcHByb3ZlJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgaW1hZ2UgZmlsZSB0eXBlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlSW1hZ2VUeXBlKGZpbGVOYW1lOiBzdHJpbmcpOiBNb2RlcmF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBhbGxvd2VkVHlwZXMgPSBbJy5qcGcnLCAnLmpwZWcnLCAnLnBuZycsICcuZ2lmJywgJy53ZWJwJ107XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZU5hbWUudG9Mb3dlckNhc2UoKS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKSk7XG4gICAgXG4gICAgaWYgKCFhbGxvd2VkVHlwZXMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwcm92ZWQ6IGZhbHNlLFxuICAgICAgICBjb25maWRlbmNlOiAxLjAsXG4gICAgICAgIHJlYXNvbnM6IFtgRmlsZSB0eXBlICR7ZXh0ZW5zaW9ufSBub3QgYWxsb3dlZC4gQWxsb3dlZDogJHthbGxvd2VkVHlwZXMuam9pbignLCAnKX1gXSxcbiAgICAgICAgY2F0ZWdvcnk6ICdpbmFwcHJvcHJpYXRlJyxcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uOiAncmVqZWN0J1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGFwcHJvdmVkOiB0cnVlLFxuICAgICAgY29uZmlkZW5jZTogMS4wLFxuICAgICAgcmVhc29uczogWydJbWFnZSBmaWxlIHR5cGUgdmFsaWQnXSxcbiAgICAgIGNhdGVnb3J5OiAnc2FmZScsXG4gICAgICBzdWdnZXN0ZWRBY3Rpb246ICdhcHByb3ZlJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgdmlkZW8gZmlsZSB0eXBlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlVmlkZW9UeXBlKGZpbGVOYW1lOiBzdHJpbmcpOiBNb2RlcmF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBhbGxvd2VkVHlwZXMgPSBbJy5tcDQnLCAnLndlYm0nLCAnLm1vdicsICcuYXZpJ107XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gZmlsZU5hbWUudG9Mb3dlckNhc2UoKS5zdWJzdHJpbmcoZmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKSk7XG4gICAgXG4gICAgaWYgKCFhbGxvd2VkVHlwZXMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwcm92ZWQ6IGZhbHNlLFxuICAgICAgICBjb25maWRlbmNlOiAxLjAsXG4gICAgICAgIHJlYXNvbnM6IFtgVmlkZW8gdHlwZSAke2V4dGVuc2lvbn0gbm90IGFsbG93ZWQuIEFsbG93ZWQ6ICR7YWxsb3dlZFR5cGVzLmpvaW4oJywgJyl9YF0sXG4gICAgICAgIGNhdGVnb3J5OiAnaW5hcHByb3ByaWF0ZScsXG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbjogJ3JlamVjdCdcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBhcHByb3ZlZDogdHJ1ZSxcbiAgICAgIGNvbmZpZGVuY2U6IDEuMCxcbiAgICAgIHJlYXNvbnM6IFsnVmlkZW8gZmlsZSB0eXBlIHZhbGlkJ10sXG4gICAgICBjYXRlZ29yeTogJ3NhZmUnLFxuICAgICAgc3VnZ2VzdGVkQWN0aW9uOiAnYXBwcm92ZSdcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBjb250ZW50TW9kZXJhdG9yID0gbmV3IENvbnRlbnRNb2RlcmF0b3IoKTsiXSwibmFtZXMiOlsiQ29udGVudE1vZGVyYXRvciIsIm1vZGVyYXRlVGV4dCIsInRleHQiLCJvcHRpb25zIiwiY2hlY2tQcm9mYW5pdHkiLCJjaGVja1NwYW0iLCJjaGVja0lsbGVnYWxDb250ZW50IiwiY2hlY2tQZXJzb25hbEluZm8iLCJxdWlja0NoZWNrIiwicXVpY2tUZXh0Q2hlY2siLCJhcHByb3ZlZCIsImNvbmZpZGVuY2UiLCJPUEVOQUlfQVBJX0tFWSIsImFpTW9kZXJhdGVUZXh0IiwiZXJyb3IiLCJjb25zb2xlIiwicmVhc29ucyIsImNhdGVnb3J5Iiwic3VnZ2VzdGVkQWN0aW9uIiwibW9kZXJhdGVJbWFnZSIsImltYWdlQnVmZmVyIiwiZmlsZU5hbWUiLCJjaGVja051ZGl0eSIsImNoZWNrVmlvbGVuY2UiLCJjaGVja0lsbGVnYWxJdGVtcyIsIm1heEZpbGVTaXplTUIiLCJzaXplQ2hlY2siLCJjaGVja0ZpbGVTaXplIiwidHlwZUNoZWNrIiwidmFsaWRhdGVJbWFnZVR5cGUiLCJhaU1vZGVyYXRlSW1hZ2UiLCJtb2RlcmF0ZVZpZGVvIiwidmlkZW9CdWZmZXIiLCJ2YWxpZGF0ZVZpZGVvVHlwZSIsImxvd2VyVGV4dCIsInRvTG93ZXJDYXNlIiwiaXNzdWVzIiwicHJvZmFuaXR5UGF0dGVybnMiLCJpbmFwcHJvcHJpYXRlUGF0dGVybnMiLCJwZXJzb25hbEluZm9QYXR0ZXJucyIsInNwYW1QYXR0ZXJucyIsInNldmVyaXR5IiwiZm9yRWFjaCIsInBhdHRlcm4iLCJ0ZXN0IiwicHVzaCIsIk1hdGgiLCJtaW4iLCJtYXgiLCJsZW5ndGgiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaW5wdXQiLCJtb2RlbCIsImRhdGEiLCJqc29uIiwicmVzdWx0IiwicmVzdWx0cyIsImZsYWdnZWQiLCJjYXRlZ29yaWVzIiwic2V4dWFsIiwiaGF0ZSIsInZpb2xlbmNlIiwiaWxsZWdhbCIsImJhc2U2NEltYWdlIiwidG9TdHJpbmciLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidHlwZSIsImltYWdlX3VybCIsInVybCIsIm1heF90b2tlbnMiLCJhaVJlc3BvbnNlIiwicGFyc2UiLCJjaG9pY2VzIiwibWVzc2FnZSIsImJ1ZmZlciIsIm1heFNpemVNQiIsInNpemUiLCJtYXhCeXRlcyIsInRvRml4ZWQiLCJhbGxvd2VkVHlwZXMiLCJleHRlbnNpb24iLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImluY2x1ZGVzIiwiam9pbiIsInByb2Nlc3MiLCJlbnYiLCJDT05URU5UX1BPTElDWSIsInByb2hpYml0ZWQiLCJlbmNvdXJhZ2VkIiwiY29udGVudE1vZGVyYXRvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/contentModerator.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmoderate-text&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fmoderate-text.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmoderate-text&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fmoderate-text.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_moderate_text_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/moderate-text.ts */ \"(api-node)/./pages/api/moderate-text.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_moderate_text_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_moderate_text_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/moderate-text\",\n        pathname: \"/api/moderate-text\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_moderate_text_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/moderate-text\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/moderate-text\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGbW9kZXJhdGUtdGV4dCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGbW9kZXJhdGUtdGV4dC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDQztBQUN1QztBQUNyQztBQUMxRDtBQUN5RDtBQUNlO0FBQ0Y7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztBQUMvRCxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQjtBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBd0Q7QUFDcEU7QUFDQTtBQUNBLHVCQUF1Qiw0RUFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw2Q0FBNkMsRUFBNkM7QUFDMUYsNENBQTRDLEtBQXdDO0FBQ3BGLGlDQUFpQyxLQUFvQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxRUFBUztBQUNqQixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBpLXV0aWxzXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9tb2RlcmF0ZS10ZXh0LnRzXCI7XG5pbXBvcnQgeyBnZXRUcmFjZXIsIFNwYW5LaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL3RyYWNlclwiO1xuaW1wb3J0IHsgQmFzZVNlcnZlclNwYW4gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvY29uc3RhbnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL21vZGVyYXRlLXRleHRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9tb2RlcmF0ZS10ZXh0XCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmQsXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnXG59KTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9tb2RlcmF0ZS10ZXh0XCI7XG4gICAgLy8gdHVyYm9wYWNrIGRvZXNuJ3Qgbm9ybWFsaXplIGAvaW5kZXhgIGluIHRoZSBwYWdlIG5hbWVcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRvIHByb2Nlc3MgZHluYW1pYyByb3V0ZXMgcHJvcGVybHlcbiAgICAvLyBUT0RPOiBmaXggdHVyYm9wYWNrIHByb3ZpZGluZyBkaWZmZXJpbmcgdmFsdWUgZnJvbSB3ZWJwYWNrXG4gICAgaWYgKHByb2Nlc3MuZW52LlRVUkJPUEFDSykge1xuICAgICAgICBzcmNQYWdlID0gc3JjUGFnZS5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJykgfHwgJy8nO1xuICAgIH1cbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlXG4gICAgfSk7XG4gICAgaWYgKCFwcmVwYXJlUmVzdWx0KSB7XG4gICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgICAgICByZXMuZW5kKCdCYWQgUmVxdWVzdCcpO1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBxdWVyeSwgcGFyYW1zLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgICAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICAgICAgY29uc3QgYWN0aXZlU3BhbiA9IHRyYWNlci5nZXRBY3RpdmVTY29wZVNwYW4oKTtcbiAgICAgICAgY29uc3Qgb25SZXF1ZXN0RXJyb3IgPSByb3V0ZU1vZHVsZS5pbnN0cnVtZW50YXRpb25PblJlcXVlc3RFcnJvci5iaW5kKHJvdXRlTW9kdWxlKTtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PnJvdXRlTW9kdWxlLnJlbmRlcihyZXEsIHJlcywge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICAuLi5wYXJhbXNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgICBhbGxvd2VkUmV2YWxpZGF0ZUhlYWRlcktleXM6IHByb2Nlc3MuZW52Ll9fTkVYVF9BTExPV0VEX1JFVkFMSURBVEVfSEVBREVSUyxcbiAgICAgICAgICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGU6IEJvb2xlYW4ocHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERSksXG4gICAgICAgICAgICAgICAgdHJ1c3RIb3N0SGVhZGVyOiBwcm9jZXNzLmVudi5fX05FWFRfVFJVU1RfSE9TVF9IRUFERVIsXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogZ2V0IHRoaXMgZnJvbSBmcm9tIHJ1bnRpbWUgZW52IHNvIG1hbmlmZXN0XG4gICAgICAgICAgICAgICAgLy8gZG9lc24ndCBuZWVkIHRvIGxvYWRcbiAgICAgICAgICAgICAgICBwcmV2aWV3UHJvcHM6IHByZXJlbmRlck1hbmlmZXN0LnByZXZpZXcsXG4gICAgICAgICAgICAgICAgcHJvcGFnYXRlRXJyb3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRldjogcm91dGVNb2R1bGUuaXNEZXYsXG4gICAgICAgICAgICAgICAgcGFnZTogXCIvYXBpL21vZGVyYXRlLXRleHRcIixcbiAgICAgICAgICAgICAgICBpbnRlcm5hbFJldmFsaWRhdGU6IHJvdXRlclNlcnZlckNvbnRleHQgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlclNlcnZlckNvbnRleHQucmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiAoLi4uYXJncyk9Pm9uUmVxdWVzdEVycm9yKHJlcSwgLi4uYXJncylcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGludm9rZVJvdXRlTW9kdWxlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgcmUtdGhyb3cgaW4gZGV2IHRvIHNob3cgdGhlIGVycm9yIG92ZXJsYXlcbiAgICAgICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcyBpcyB0ZWNobmljYWxseSBhbiBpbnZhcmlhbnQgYXMgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgLy8gc2hvdWxkIGJlIGRvbmUgaW5zaWRlIG9mIGFwaS1yZXNvbHZlciBvbkVycm9yXG4gICAgICAgIHNlbmRFcnJvcihyZXMsIDUwMCwgJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgIH0gZmluYWxseXtcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWxsb3cgYW55IHdhaXRVbnRpbCB3b3JrIGluIHBhZ2VzIEFQSSByb3V0ZXMgY3VycmVudGx5XG4gICAgICAgIC8vIHNvIGlmIGNhbGxiYWNrIGlzIHByZXNlbnQgcmV0dXJuIHdpdGggcmVzb2x2ZWQgcHJvbWlzZSBzaW5jZSBub1xuICAgICAgICAvLyBwZW5kaW5nIHdvcmtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmoderate-text&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fmoderate-text.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/moderate-text.ts":
/*!************************************!*\
  !*** ./pages/api/moderate-text.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_contentModerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/contentModerator */ \"(api-node)/./lib/contentModerator.ts\");\n\nasync function handler(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    try {\n        const { text } = req.body;\n        if (!text || typeof text !== 'string') {\n            return res.status(400).json({\n                error: 'Text is required'\n            });\n        }\n        // Moderate the text\n        const result = await _lib_contentModerator__WEBPACK_IMPORTED_MODULE_0__.contentModerator.moderateText(text);\n        return res.status(200).json(result);\n    } catch (error) {\n        console.error('Text moderation error:', error);\n        return res.status(500).json({\n            error: 'Moderation failed',\n            approved: true,\n            confidence: 0,\n            reasons: [\n                'Moderation service temporarily unavailable'\n            ]\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9tb2RlcmF0ZS10ZXh0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQzBEO0FBRTNDLGVBQWVDLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFxQjtJQUM1RDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVDLElBQUksRUFBRSxHQUFHTixJQUFJTyxJQUFJO1FBRXpCLElBQUksQ0FBQ0QsUUFBUSxPQUFPQSxTQUFTLFVBQVU7WUFDckMsT0FBT0wsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFtQjtRQUMxRDtRQUVBLG9CQUFvQjtRQUNwQixNQUFNRyxTQUFTLE1BQU1WLG1FQUFnQkEsQ0FBQ1csWUFBWSxDQUFDSDtRQUVuRCxPQUFPTCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDSTtJQUU5QixFQUFFLE9BQU9ILE9BQVk7UUFDbkJLLFFBQVFMLEtBQUssQ0FBQywwQkFBMEJBO1FBQ3hDLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJDLE9BQU87WUFDUE0sVUFBVTtZQUNWQyxZQUFZO1lBQ1pDLFNBQVM7Z0JBQUM7YUFBNkM7UUFDekQ7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3BhZ2VzL2FwaS9tb2RlcmF0ZS10ZXh0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHsgY29udGVudE1vZGVyYXRvciB9IGZyb20gJ0AvbGliL2NvbnRlbnRNb2RlcmF0b3InO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHsgdGV4dCB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIXRleHQgfHwgdHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1RleHQgaXMgcmVxdWlyZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIE1vZGVyYXRlIHRoZSB0ZXh0XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGVudE1vZGVyYXRvci5tb2RlcmF0ZVRleHQodGV4dCk7XG5cbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24ocmVzdWx0KTtcblxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignVGV4dCBtb2RlcmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIGVycm9yOiAnTW9kZXJhdGlvbiBmYWlsZWQnLFxuICAgICAgYXBwcm92ZWQ6IHRydWUsIC8vIEZhaWwgb3BlbiBmb3IgYmV0dGVyIFVYXG4gICAgICBjb25maWRlbmNlOiAwLFxuICAgICAgcmVhc29uczogWydNb2RlcmF0aW9uIHNlcnZpY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUnXVxuICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY29udGVudE1vZGVyYXRvciIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ0ZXh0IiwiYm9keSIsInJlc3VsdCIsIm1vZGVyYXRlVGV4dCIsImNvbnNvbGUiLCJhcHByb3ZlZCIsImNvbmZpZGVuY2UiLCJyZWFzb25zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/moderate-text.ts\n");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fmoderate-text&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fmoderate-text.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();