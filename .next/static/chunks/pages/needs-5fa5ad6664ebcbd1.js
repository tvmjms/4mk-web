(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[431],{657:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>u});var s=l(7876),a=l(7328),n=l.n(a),r=l(8230),i=l.n(r),d=l(4232),c=l(8100);function o(e){var t,l,a;let{onChange:n,initial:r}=e,[i,c]=(0,d.useState)(null!=(t=null==r?void 0:r.q)?t:""),[o,u]=(0,d.useState)(null!=(l=null==r?void 0:r.timeframe)?l:"all"),[x,m]=(0,d.useState)(null!=(a=null==r?void 0:r.sort)?a:"newest");return(0,d.useEffect)(()=>{n({q:i,timeframe:o,sort:x})},[i,o,x,n]),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3 items-center",children:[(0,s.jsx)("input",{value:i,onChange:e=>c(e.target.value),placeholder:"Search title, description, location...",className:"flex-1 min-w-[240px] rounded-xl bg-white/90 border border-neutral-300 px-4 py-2 shadow-inner outline-none focus:ring-2 focus:ring-neutral-400"}),(0,s.jsxs)("select",{value:o,onChange:e=>u(e.target.value),className:"rounded-xl bg-white/90 border border-neutral-300 px-3 py-2",children:[(0,s.jsx)("option",{value:"all",children:"All time"}),(0,s.jsx)("option",{value:"24h",children:"Last 24h"}),(0,s.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,s.jsx)("option",{value:"30d",children:"Last 30 days"})]}),(0,s.jsxs)("select",{value:x,onChange:e=>m(e.target.value),className:"rounded-xl bg-white/90 border border-neutral-300 px-3 py-2",children:[(0,s.jsx)("option",{value:"newest",children:"Newest"}),(0,s.jsx)("option",{value:"oldest",children:"Oldest"})]})]})}function u(){let e=(0,c.createPagesBrowserClient)(),[t,l]=(0,d.useState)({q:"",timeframe:"all",sort:"newest"}),[a,r]=(0,d.useState)([]),[u,x]=(0,d.useState)([]),[m,h]=(0,d.useState)(!0),[f,p]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{let{data:t,error:l}=await e.from("needs").select("*").is("deleted_at",null).order("created_at",{ascending:!1}),{data:s}=await e.from("fulfillment").select("*");l&&p(l.message),r(t||[]),x(s||[]),h(!1)})()},[e]);let g=e=>{let t=u.find(t=>t.need_id===e);return t?"accepted"===t.status?"Accepted by Helper":"fulfilled"===t.status?"Fulfilled":"Unfulfilled":"Unfulfilled"},w=a.filter(e=>(e=>{if("all"===t.timeframe)return!0;let l=e.created_at?new Date(e.created_at):null;if(!l)return!1;let s=(Date.now()-l.getTime())/864e5;return"24h"===t.timeframe?s<=1:"7d"===t.timeframe?s<=7:"30d"!==t.timeframe||s<=30})(e)&&(e=>{let l=t.q.trim().toLowerCase();return!l||[e.title,e.description,e.category,e.city,e.state].filter(Boolean).join(" ").toLowerCase().includes(l)})(e));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"All Needs — 4MK"})}),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"All Needs"})}),(0,s.jsx)(o,{onChange:l,initial:t}),m&&(0,s.jsx)("p",{children:"Loading…"}),f&&(0,s.jsxs)("p",{className:"text-red-600",children:["Error: ",f]}),!m&&!f&&0===w.length&&(0,s.jsx)("p",{children:"No needs found."}),(0,s.jsx)("div",{className:"grid sm:grid-cols-1 md:grid-cols-2 gap-4",children:w.map(e=>(0,s.jsxs)(i(),{href:"/needs/".concat(e.id),className:"block border rounded-lg p-4 shadow-sm bg-white hover:bg-purple-50 transition",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-1",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.city||"—",e.state?", ".concat(e.state):""," •"," ",e.created_at?new Date(e.created_at).toLocaleString():""]}),(0,s.jsx)("span",{className:"inline-block mt-2 px-2 py-1 rounded text-xs font-medium ".concat("Unfulfilled"===g(e.id)?"bg-yellow-100 text-yellow-800":"Accepted by Helper"===g(e.id)?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:g(e.id)})]},e.id))})]})]})}},3297:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/needs",function(){return l(657)}])},7328:(e,t,l)=>{e.exports=l(9269)}},e=>{e.O(0,[636,593,792],()=>e(e.s=3297)),_N_E=e.O()}]);