(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{3803:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>u});var n=t(7876),r=t(4232),i=t(8230),a=t.n(i),d=t(9099),s=t(7137);function u(){var e,l;let t=(0,d.useRouter)(),[i,u]=(0,r.useState)(null),[c,o]=(0,r.useState)(null),[f,h]=(0,r.useState)([]),[p,x]=(0,r.useState)([]),[m,y]=(0,r.useState)(0),[g,j]=(0,r.useState)(0),[_,w]=(0,r.useState)(!0),[N,v]=(0,r.useState)(null),[b,S]=(0,r.useState)({}),k=Math.max(1,Number(null!=(e=Array.isArray(t.query.un)?t.query.un[0]:t.query.un)?e:"1")||1),q=Math.max(1,Number(null!=(l=Array.isArray(t.query.ful)?t.query.ful[0]:t.query.ful)?l:"1")||1),C=(k-1)*10,M=C+10-1,P=(q-1)*10,E=P+10-1;(0,r.useEffect)(()=>{let e=!1;return(async()=>{var l,t;let{data:{user:n}}=await s.N.auth.getUser();e||(u(null!=(l=null==n?void 0:n.id)?l:null),o(null!=(t=null==n?void 0:n.email)?t:null))})(),()=>{e=!0}},[]),(0,r.useEffect)(()=>{if(!i)return;let e=!1;return(async()=>{var l,t,n,r,a,d;w(!0),v(null);let u=s.N.from("needs").select("id,title,city,category,created_at,fulfilled_at,owner_id",{count:"exact"}).eq("owner_id",i).is("deleted_at",null).is("fulfilled_at",null).order("created_at",{ascending:!1}).range(C,M),c=s.N.from("needs").select("id,title,city,category,created_at,fulfilled_at,owner_id",{count:"exact"}).eq("owner_id",i).is("deleted_at",null).not("fulfilled_at","is",null).order("created_at",{ascending:!1}).range(P,E),[o,f]=await Promise.all([u,c]);if(e)return;if(o.error){v(o.error.message),w(!1);return}if(f.error){v(f.error.message),w(!1);return}h(null!=(l=o.data)?l:[]),x(null!=(t=f.data)?t:[]),y(null!=(n=o.count)?n:0),j(null!=(r=f.count)?r:0),w(!1);let p=[...null!=(a=o.data)?a:[],...null!=(d=f.data)?d:[]].map(e=>e.id);if(!p.length)return S({});let{data:m,error:g}=await s.N.from("fulfillment").select("need_id,status").in("need_id",p);if(g)return;let _={};for(let e of p)_[e]={proposed:0,accepted:0,fulfilled:0,declined:0};(null!=m?m:[]).forEach(e=>{let l=_[e.need_id];l&&("proposed"===e.status?l.proposed++:"accepted"===e.status?l.accepted++:"fulfilled"===e.status?l.fulfilled++:"declined"===e.status&&l.declined++)}),S(_)})(),()=>{e=!0}},[i,k,q]);let T=Math.max(1,Math.ceil(m/10)),A=Math.max(1,Math.ceil(g/10)),F=e=>{t.push({pathname:"/needs/mine",query:{un:k,ful:q,...e}})},B=async e=>{if(!confirm("Mark this need as fulfilled?"))return;let{error:l}=await s.N.from("needs").update({fulfilled_at:new Date().toISOString()}).eq("id",e).eq("owner_id",i);l?alert(l.message):t.replace(t.asPath)};return(0,n.jsxs)("main",{style:{padding:24,maxWidth:900},children:[(0,n.jsx)("h1",{children:"My needs"}),(0,n.jsxs)("p",{children:[(0,n.jsx)(a(),{href:"/needs",children:"← All needs"})," • ",(0,n.jsx)(a(),{href:"/needs/new",children:"Create a need"})]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("em",{children:"Signed in as:"})," ",null!=c?c:"—"]}),N&&(0,n.jsx)("p",{style:{color:"crimson"},children:N}),_&&(0,n.jsx)("p",{children:"Loading…"}),(0,n.jsxs)("section",{style:{marginTop:16},children:[(0,n.jsx)("h2",{children:"Unfulfilled"}),0===f.length?(0,n.jsx)("p",{children:"None yet."}):(0,n.jsx)("ul",{children:f.map(e=>{var l;let t=null!=(l=b[e.id])?l:{proposed:0,accepted:0,fulfilled:0,declined:0};return(0,n.jsxs)("li",{style:{marginBottom:8},children:[(0,n.jsx)(a(),{href:"/needs/".concat(e.id),children:e.title}),e.city&&(0,n.jsxs)(n.Fragment,{children:[" — ",e.city]}),e.category&&(0,n.jsxs)(n.Fragment,{children:[" (",e.category,")"]}),(0,n.jsxs)("div",{style:{fontSize:12,color:"#555",marginTop:2},children:[t.proposed," proposed • ",t.accepted," accepted • ",t.fulfilled," fulfilled"]}),(0,n.jsx)("div",{style:{marginTop:4},children:(0,n.jsx)("button",{onClick:()=>B(e.id),children:"Mark fulfilled"})})]},e.id)})}),T>1&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,n.jsx)("button",{disabled:k<=1,onClick:()=>F({un:k-1}),children:"← Prev"}),(0,n.jsxs)("span",{children:["Page ",k," / ",T," • ",m," total"]}),(0,n.jsx)("button",{disabled:k>=T,onClick:()=>F({un:k+1}),children:"Next →"})]})]}),(0,n.jsxs)("section",{style:{marginTop:24},children:[(0,n.jsx)("h2",{children:"Fulfilled"}),0===p.length?(0,n.jsx)("p",{children:"None yet."}):(0,n.jsx)("ul",{children:p.map(e=>(0,n.jsxs)("li",{style:{marginBottom:8},children:[(0,n.jsx)(a(),{href:"/needs/".concat(e.id),children:e.title}),e.city&&(0,n.jsxs)(n.Fragment,{children:[" — ",e.city]}),e.category&&(0,n.jsxs)(n.Fragment,{children:[" (",e.category,")"]}),(0,n.jsx)("em",{children:" • fulfilled"})]},e.id))}),A>1&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,n.jsx)("button",{disabled:q<=1,onClick:()=>F({ful:q-1}),children:"← Prev"}),(0,n.jsxs)("span",{children:["Page ",q," / ",A," • ",g," total"]}),(0,n.jsx)("button",{disabled:q>=A,onClick:()=>F({ful:q+1}),children:"Next →"})]})]})]})}},7137:(e,l,t)=>{"use strict";t.d(l,{N:()=>r});var n=t(8100);t(5364);let r=(0,n.createPagesBrowserClient)()},7630:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/needs/mine",function(){return t(3803)}])}},e=>{e.O(0,[636,593,792],()=>e(e.s=7630)),_N_E=e.O()}]);